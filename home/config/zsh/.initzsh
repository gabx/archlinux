# file:   ~/.config/zsh/initzsh 
# Last modified: 2015-11-28
# Do not forget to set ~/.config/locale.conf otherwise zsh comp will repeat letters after [TAB]
     		
# http://zsh.sourceforge.net/Doc/Release/zsh.html#Top
# https://wiki.archlinux.org/index.php/Dotfiles

# source $HOME/.profile
 if [[ -f "$HOME/.config/.profile" ]]; then
 	. $HOME/.config/.profile
 fi

# For convenience
# export ZDOTDIR=$HOME/.config/zsh


HISTFILE=$HOME/.config/zsh/.zsh_histfile
HISTSIZE=5000
SAVEHIST=5000
                                 
# source config files until 09 
[ -d $HOME/.config/zsh/zshrc.d ] && {
for f in $HOME/.config/zsh/zshrc.d/0* ; do
    source $f
done 
}

# color ls
eval `dircolors $HOME/.config/LS_COLORS`

# needed by Python virtualenvwarpper
# source /usr/bin/virtualenvwrapper.sh

# load functions
autoload $HOME/.config/zsh/functions/[^_]*(.:t)
                                                   
# search Arch repo when a command is not found
source /usr/share/doc/pkgfile/command-not-found.zsh	

# modules # 
# compinit -u disable security check.                                                 
autoload -Uz compinit -u && compinit -u -d $HOME/.config/zsh/.zcompdump		# autoload compinit & dump in -d directory
autoload -U colors && colors						# load terminal colors  
autoload -U promptinit && promptinit					# autoload prompt
autoload vcs_info                           

# https://github.com/ajeetdsouza/zoxide?tab=readme-ov-file#getting-started
eval "$(zoxide init zsh)"


# Prompt - MUST be after autoload colors
# the | is needed otherwise tab completion will double the first letter of the command
# need to remove the "➤➤" when on VT
# different prompt for root and different prompt for screen

if [[ $TERM = "linux" || $TERM = "vt102" ]] 
	then
		if [[ "$EUID" = "0" || "$USER" = "root" ]]
		then
			PROMPT="%{$fg_bold[red]%}%n%{$reset_color%}@%{$fg_bold[yellow]%}%m %{$fg[green]%}%1|%2~ %{$reset_color%}%# "
		else 	
			PROMPT="%n@%{$fg_bold[yellow]%}%m %{$fg[green]%}%1|%2~ %{$reset_color%}%# "
		fi
	else
	if [[ "$EUID" = "0" || "$USER" = "root" ]]
		then	
			PROMPT="%{$fg_bold[red]%}%n%{$reset_color%}@%{$fg_bold[yellow]%}%m %{$fg[green]%}%1|➤➤ %2~ %{$reset_color%}%# "	
		else
			PROMPT="%n@%{$fg_bold[yellow]%}%m %{$fg[green]%}%1|➤➤ %2~ %{$reset_color%}%# "
		fi	
fi

                                           
# Compile the completion dump to increase startup speed.
zcompdump=$HOME/.config/zsh/.zcompdump
if [[ "$zcompdump" -nt "${zcompdump}.zwc" || ! -s "${zcompdump}.zwc" ]]; then
zcompile "$zcompdump"
fi		

									







